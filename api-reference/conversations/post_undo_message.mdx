---
title: Undo Message
method: POST
endpoint: "/conversations/<id>/messages/<message_id>/undo"
openapi: 'POST /conversations/<id>/messages/<message_id>/undo'
docstring_hash: 5d6b10ce0f90686f9e9d91f392954d51162cdeb4

parameters:
  - id <int>
  - message_id <str>
---

Possible by the author only, and if the message has not been sent
No need to check by roles, since we check the author, it mean they had the role to send in the first place

If the message is the only one in this conversation, and is out, it means it was a compose.
In this case, we delete the message and the conversation

Otherwise:

This function goes into three separate steps
1. It cancels the message to be send, to ensure it won't be sent at all (a flush is done to ensure that)
2. It rebuilds the original message, including attachments, inline images and actions, then ensure this is properly saved
3. It deletes the files at AWS S3

The draft is then returned
